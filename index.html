<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate PDF Certificate</title>
</head>
<body>
    <h1>Generate PDF Certificate</h1>
    
    <label for="search">Search by Student ID:</label>
    <input type="text" id="search" />
    <button onclick="searchStudent()">Search</button>

    <div id="studentList"></div>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.13.0/dist/pdf-lib.js"></script>
    <script>


// Sample JSON data
const studentsData = {
  "students": [
    {
      "id": "1",
      "name": "John Doe",
      "course": "Computer Science",
      "completionDate": "2023-10-10"
    },
    {
      "id": "2",
      "name": "Jane Smith",
      "course": "Mathematics",
      "completionDate": "2023-10-11"
    },
    {
      "id": "3",
      "name": "Bob Johnson",
      "course": "Physics",
      "completionDate": "2023-10-12"
    }
   
  ]
};

// Display all students initially
displayStudents(studentsData.students);

function displayStudents(students) {
    const studentListDiv = document.getElementById('studentList');
    studentListDiv.innerHTML = '';

    students.forEach(student => {
        const studentDiv = document.createElement('div');
        studentDiv.innerHTML = `
            <p>${student.name} (ID: ${student.id}) - ${student.course}</p>
            <button onclick="generateCertificate('${student.id}')">Generate Certificate</button>
            <hr>
        `;
        studentListDiv.appendChild(studentDiv);
    });
}

function searchStudent() {
    const searchInput = document.getElementById('search');
    const searchTerm = searchInput.value.toLowerCase();

    // Filter students based on the search term
    const filteredStudents = studentsData.students.filter(student => student.id.toLowerCase().includes(searchTerm));

    displayStudents(filteredStudents);
}

async function generateCertificate(studentId) {
    // Fetch student details based on the ID
    const studentDetails = await fetchStudentDetails(studentId);

    if (!studentDetails) {
        alert('Student not found');
        return;
    }

    // Generate PDF certificate
    const pdfDoc = await PDFLib.PDFDocument.create();
    const page = pdfDoc.addPage([600, 400]);

    // Add content to the certificate
    const { width, height } = page.getSize();
    const { x, y } = { x: 50, y: height - 150 };

    page.drawText(`Certificate of Completion`, { x, y, fontSize: 20 });
    page.drawText(`This is to certify that`, { x, y: y - 30, fontSize: 14 });
    page.drawText(`${studentDetails.name}`, { x, y: y - 60, fontSize: 18, color: RGB(0, 0, 0) });
    page.drawText(`has successfully completed the course.`, { x, y: y - 90, fontSize: 14 });

    // Save the PDF to a file
    const pdfBytes = await pdfDoc.save();
    downloadPDF(pdfBytes, `${studentDetails.name}_Certificate.pdf`);
}

async function fetchStudentDetails(studentId) {
    try {
        // Find the student with the given ID
        const student = studentsData.students.find(s => s.id === studentId);

        if (!student) {
            console.error(`Student with ID ${studentId} not found`);
            return null;
        }

        return student;
    } catch (error) {
        console.error('Error fetching student details:', error);
        return null;
    }
}

function downloadPDF(pdfBytes, filename) {
    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = filename;
    link.click();
}

        
    </script>
</body>
</html>
